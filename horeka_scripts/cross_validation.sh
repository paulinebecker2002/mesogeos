#!/bin/bash
#SBATCH --job-name=cval_gtn
#SBATCH --partition=accelerated
#SBATCH --account=hk-project-p0024498
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=8
#SBATCH --gpus=1
#SBATCH --gres=gpu:1
#SBATCH --mem=480G
#SBATCH --time=23:00:00
#SBATCH --mail-type=END,FAIL
#SBATCH --mail-user=pauline.becker@student.kit.edu

cd /hkfs/work/workspace/scratch/uyxib-pauline_gddpfa/mesogeos/code/ml_tracks/a_fire_danger

PYTHON=~/miniconda3/envs/mesogeos_py38/bin/python
CONFIG=configs/config_gtn/config_train.json

declare -a VAL_SETS=(
  "2006" "2007" "2008" "2009" "2010"
  "2011" "2012" "2013" "2014" "2015"
  "2016" "2017" "2018" "2019" "2020"
)

declare -a TEST_SETS=(
  "2007 2008" "2008 2009" "2009 2010" "2010 2011" "2011 2012"
  "2012 2013" "2013 2014" "2014 2015" "2015 2016" "2016 2017"
  "2017 2018" "2018 2019" "2019 2020" "2020 2021" "2021 2022"
)

declare -a TRAIN_SETS=(
  "2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022"
  "2006 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022"
  "2006 2007 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022"
  "2006 2007 2008 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022"
  "2006 2007 2008 2009 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022"
  "2006 2007 2008 2009 2010 2014 2015 2016 2017 2018 2019 2020 2021 2022"
  "2006 2007 2008 2009 2010 2011 2015 2016 2017 2018 2019 2020 2021 2022"
  "2006 2007 2008 2009 2010 2011 2012 2016 2017 2018 2019 2020 2021 2022"
  "2006 2007 2008 2009 2010 2011 2012 2013 2017 2018 2019 2020 2021 2022"
  "2006 2007 2008 2009 2010 2011 2012 2013 2014 2018 2019 2020 2021 2022"
  "2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2019 2020 2021 2022"
  "2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2020 2021 2022"
  "2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2021 2022"
  "2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2022"
  "2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019"
)

for i in "${!TEST_SETS[@]}"; do
  echo "Running fold $i with test=${TEST_SETS[$i]}, val=${VAL_SETS[$i]}"
  $PYTHON train.py \
    --config $CONFIG \
    --train_year ${TRAIN_SETS[$i]} \
    --val_year ${VAL_SETS[$i]} \
    --test_year ${TEST_SETS[$i]}
done